/**
 * MCP Protocol Types
 * 
 * These types represent the standard MCP (Model Context Protocol) response types.
 * They are used as default return types when tools don't specify an outputSchema.
 */

/**
 * Result of a tool call
 */
export interface CallToolResult {
  /**
   * A list of content objects that represent the result of the tool call
   */
  content: Content[];

  /**
   * Optional structured result of the tool call
   */
  structuredContent?: any;

  /**
   * Whether the tool call ended in an error
   */
  isError?: boolean;
}

/**
 * Content types that can be returned by tools
 */
export type Content = TextContent | ImageContent | ResourceContent;

/**
 * Text content
 */
export interface TextContent {
  type: "text";
  text: string;
}

/**
 * Image content (base64 encoded)
 */
export interface ImageContent {
  type: "image";
  data: string;
  mimeType: string;
}

/**
 * Resource reference content
 */
export interface ResourceContent {
  type: "resource";
  resource: {
    uri: string;
    mimeType?: string;
    text?: string;
    blob?: string;
  };
}

/**
 * Helper function to extract text from CallToolResult
 */
export function extractText(result: CallToolResult): string {
  const textContent = result.content.find(c => c.type === "text") as TextContent | undefined;
  return textContent?.text || "";
}

/**
 * Helper function to extract JSON from CallToolResult
 */
export function extractJSON<T = any>(result: CallToolResult): T {
  if (result.structuredContent) {
    return result.structuredContent as T;
  }
  
  const text = extractText(result);
  if (text) {
    try {
      return JSON.parse(text) as T;
    } catch {
      throw new Error("Failed to parse JSON from text content");
    }
  }
  
  throw new Error("No structured content or text content found");
}

/**
 * Helper function to check if result is an error
 */
export function isErrorResult(result: CallToolResult): boolean {
  return result.isError === true;
}

